name: CD - Production Deployment

# Ù‡Ø± ÙˆÙ‚Øª Ú©Ø¯ÛŒ Ø¨Ù‡ Ø´Ø§Ø®Ù‡ Ø§ØµÙ„ÛŒ (main) Ù…Ø±Ø¬ Ø´Ø¯ØŒ Ø§ÛŒÙ† Ø§Ø¬Ø±Ø§ Ù…ÛŒØ´Ù‡
on:
  push:
    branches: [ "main" ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Connect and Deploy ğŸš€
        uses: appleboy/ssh-action@v1.0.3
        with:
          # Ø§ÛŒÙ† Ù…ØªØºÛŒØ±Ù‡Ø§ Ø±Ùˆ Ø§Ø² Ù…Ø®Ø²Ù† Ø§Ø³Ø±Ø§Ø± Ú¯ÛŒØªâ€ŒÙ‡Ø§Ø¨ Ù…ÛŒØ®ÙˆÙ†Ù‡ (Ø§Ù…Ù†ÛŒØª Û±Û°Û°Ùª)
          host: ${{ secrets.SERVER_HOST }}
          username: ${{ secrets.SERVER_USER }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          port: 22
          script: |
            # 1. Ø±ÙØªÙ† Ø¨Ù‡ Ù¾ÙˆØ´Ù‡ Ù¾Ø±ÙˆÚ˜Ù‡ Ø¯Ø± Ø³Ø±ÙˆØ±
            cd /root/instastore-farid

            # 2. Ø¯Ø±ÛŒØ§ÙØª Ø¢Ø®Ø±ÛŒÙ† ØªØºÛŒÛŒØ±Ø§Øª Ø§Ø² Ú¯ÛŒØª
            git pull origin main

            # 3. Ù¾Ø§ÛŒÛŒÙ† Ø¢ÙˆØ±Ø¯Ù† Ú©Ø§Ù†ØªÛŒÙ†Ø±Ù‡Ø§ (Ø¨Ø±Ø§ÛŒ Ø§Ø·Ù…ÛŒÙ†Ø§Ù†)
            docker-compose down

            # 4. Ø¨Ø§Ù„Ø§ Ø¢ÙˆØ±Ø¯Ù† Ù…Ø¬Ø¯Ø¯ Ø¨Ø§ Ø¨ÛŒÙ„Ø¯ Ø¬Ø¯ÛŒØ¯
            docker-compose up -d --build