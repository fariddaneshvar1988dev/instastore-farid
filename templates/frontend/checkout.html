{% extends 'base.html' %}
{% load humanize %}

{% block title %}ØªØ³ÙˆÛŒÙ‡ Ø­Ø³Ø§Ø¨ | {{ shop.shop_name }}{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row">
        <div class="col-md-7">
            <div class="card shadow-sm border-0 rounded-4 mb-4">
                <div class="card-header bg-white py-3">
                    <h5 class="mb-0 fw-bold">ğŸ“ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø±Ø³Ø§Ù„</h5>
                </div>
                <div class="card-body p-4">
                    <form method="POST" id="checkout-form">
                        {% csrf_token %}
                        {% if messages %}
                            {% for message in messages %}
                                <div class="alert alert-{{ message.tags }} small">{{ message }}</div>
                            {% endfor %}
                        {% endif %}

                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ *</label>
                                <input type="text" name="customer_name" class="form-control" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ *</label>
                                <input type="tel" name="customer_phone" class="form-control" placeholder="09xxxxxxxxx" required>
                            </div>
                            <div class="col-12">
                                <label class="form-label">Ø¢Ø¯Ø±Ø³ Ø¯Ù‚ÛŒÙ‚ Ù¾Ø³ØªÛŒ *</label>
                                <textarea name="address" class="form-control" rows="3" required></textarea>
                            </div>
                            <div class="col-12">
                                <label class="form-label">ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø³ÙØ§Ø±Ø´ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)</label>
                                <textarea name="note" class="form-control" rows="2"></textarea>
                            </div>
                        </div>

                        <div class="card bg-light border-0 mt-4 rounded-3">
                            <div class="card-body">
                                <h6 class="fw-bold mb-3">ğŸ’³ Ø§Ù†ØªØ®Ø§Ø¨ Ø±ÙˆØ´ Ù¾Ø±Ø¯Ø§Ø®Øª</h6>
                                
                                {% if shop.enable_cod %}
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="radio" name="payment_method" id="pay_cod" value="cash_on_delivery" checked>
                                    <label class="form-check-label" for="pay_cod">
                                        ğŸšš Ù¾Ø±Ø¯Ø§Ø®Øª Ø¯Ø± Ù…Ø­Ù„ (Ú©Ø§Ø±ØªØ®ÙˆØ§Ù† ÛŒØ§ Ù†Ù‚Ø¯)
                                    </label>
                                </div>
                                {% endif %}

                                {% if shop.enable_card_to_card %}
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="radio" name="payment_method" id="pay_card" value="card_to_card">
                                    <label class="form-check-label" for="pay_card">
                                        ğŸ’³ Ú©Ø§Ø±Øª Ø¨Ù‡ Ú©Ø§Ø±Øª
                                        <div class="text-muted small ms-2 mt-1">
                                            Ø´Ù…Ø§Ø±Ù‡ Ú©Ø§Ø±Øª: {{ shop.card_number }} ({{ shop.card_owner_name }})
                                        </div>
                                    </label>
                                </div>
                                {% endif %}

                                {% if shop.enable_online_payment %}
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="radio" name="payment_method" id="pay_online" value="online">
                                    <label class="form-check-label" for="pay_online">
                                        ğŸŒ Ù¾Ø±Ø¯Ø§Ø®Øª Ø¢Ù†Ù„Ø§ÛŒÙ† (Ø²Ø±ÛŒÙ†â€ŒÙ¾Ø§Ù„)
                                    </label>
                                </div>
                                {% endif %}

                                {% if not shop.enable_cod and not shop.enable_card_to_card and not shop.enable_online_payment %}
                                    <div class="alert alert-warning small mb-0">Ù‡ÛŒÚ† Ø±ÙˆØ´ Ù¾Ø±Ø¯Ø§Ø®ØªÛŒ ÙØ¹Ø§Ù„ Ù†ÛŒØ³Øª. Ø¨Ø§ ÙØ±ÙˆØ´Ú¯Ø§Ù‡ ØªÙ…Ø§Ø³ Ø¨Ú¯ÛŒØ±ÛŒØ¯.</div>
                                {% endif %}
                            </div>
                        </div>

                    </form>
                </div>
            </div>
        </div>

        <div class="col-md-5">
            <div class="card shadow-sm border-0 rounded-4 sticky-top" style="top: 20px;">
                <div class="card-header bg-light py-3">
                    <h5 class="mb-0 fw-bold">ğŸ›’ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯</h5>
                </div>
                <div class="card-body">
                    {% if cart.get_total_items > 0 %}
                        {% for item in cart %}
                        <div class="d-flex align-items-center mb-3">
                            <div class="bg-light rounded me-3 d-flex align-items-center justify-content-center border" style="width: 50px; height: 50px;">
                                {% if item.product.images %}
                                    <img src="{{ item.product.images.0 }}" class="w-100 h-100 rounded" style="object-fit: cover;">
                                {% else %}
                                    <i class="bi bi-box text-muted"></i>
                                {% endif %}
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="mb-0 small fw-bold">{{ item.product.name }}</h6>
                                <div class="text-muted small" style="font-size: 0.8rem;">
                                    {{ item.quantity }} Ø¹Ø¯Ø¯ | {{ item.size }}
                                </div>
                            </div>
                            <div class="fw-bold small">{{ item.total_price|intcomma }}</div>
                        </div>
                        {% endfor %}
                        
                        <hr>
                        
                        <div class="d-flex justify-content-between mb-3">
                            <span class="text-muted">Ù…Ø¨Ù„Øº Ù‚Ø§Ø¨Ù„ Ù¾Ø±Ø¯Ø§Ø®Øª</span>
                            <span class="fw-bold fs-5 text-primary">{{ cart.get_total_price|intcomma }} ØªÙˆÙ…Ø§Ù†</span>
                        </div>

                        <button type="submit" form="checkout-form" class="btn btn-primary w-100 py-3 fw-bold rounded-3 shadow-sm">
                            âœ… Ø«Ø¨Øª Ù†Ù‡Ø§ÛŒÛŒ Ø³ÙØ§Ø±Ø´
                        </button>
                    {% else %}
                        <div class="alert alert-info text-center">Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø´Ù…Ø§ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª.</div>
                        <a href="{% url 'shop-store' shop.slug %}" class="btn btn-outline-primary w-100">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ÙØ±ÙˆØ´Ú¯Ø§Ù‡</a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}