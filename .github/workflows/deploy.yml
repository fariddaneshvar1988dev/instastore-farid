name: CD - Production Deployment

# Ù‡Ø± ÙˆÙ‚Øª Ú©Ø¯ÛŒ Ø¨Ù‡ Ø´Ø§Ø®Ù‡ Ø§ØµÙ„ÛŒ (main) Ù…Ø±Ø¬ Ø´Ø¯ØŒ Ø§ÛŒÙ† Ø§Ø¬Ø±Ø§ Ù…ÛŒØ´Ù‡
on:
  push:
    branches: [ "main" ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Connect and Deploy ðŸš€
        uses: appleboy/ssh-action@v1.0.3
        with:
          # Ø§ÛŒÙ† Ù…ØªØºÛŒØ±Ù‡Ø§ Ø±Ùˆ Ø§Ø² Ù…Ø®Ø²Ù† Ø§Ø³Ø±Ø§Ø± Ú¯ÛŒØªâ€ŒÙ‡Ø§Ø¨ Ù…ÛŒØ®ÙˆÙ†Ù‡ (Ø§Ù…Ù†ÛŒØª Û±Û°Û°Ùª)
          host: ${{ secrets.SERVER_HOST }}
          username: ${{ secrets.SERVER_USER }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          port: 22
          script: |
            cd /root/instastore-farid/instastore 
            git pull origin main
            docker compose down
            docker compose up -d --build